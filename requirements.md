# 要件定義書

## 1. プロジェクト概要

### 1.1 プロジェクト名
訪問看護事業支援システム

### 1.2 目的
訪問看護事業における業務効率化と品質向上を実現するため、シフト管理、勤怠管理、給与計算、看護記録の自動化などを統合的に管理するシステムを構築する。

### 1.4 スコープ
- シフト自動作成機能
- GPS連動勤怠管理機能
- 複雑な給与計算の自動化
- 看護記録の音声入力・自動化
- 利用者評価システム
- 訪問ルート最適化機能
- 求人文章作成支援機能

## 2. ステークホルダー

### 2.1 主要ステークホルダー
- **プロジェクトオーナー**: 林様（経営者）
- **エンドユーザー**: 
  - 訪問看護スタッフ（看護師）
  - 事務スタッフ
  - 管理者
- **開発チーム**: 志水様（開発責任者）
- **その他関係者**: 
  - 利用者様（訪問看護サービスを受ける方）
  - 利用者様のご家族

## 3. 機能要件

### 3.1 ユーザー管理
- [x] スタッフアカウント登録・管理
- [x] ログイン/ログアウト機能
- [x] パスワードリセット機能
- [x] 権限管理（管理者/スタッフ/事務）

### 3.2 主要機能

#### 3.2.1 シフト自動作成機能
- スタッフが希望シフトをシステムに提出
- Pythonでシフトを調整・最適化
- 人員不足の日は該当スタッフに再提出を促す通知
- 他スタッフの希望シフトは非公開（プライバシー保護）
- 訪問時間枠（20分未満、30分未満、30-60分、60-90分）に対応

#### 3.2.2 GPS連動勤怠管理
- 訪問開始・終了時刻の記録
- GPS情報による位置情報の記録
- 予定時刻との差異の自動検出
- 誤打刻のキャンセル機能
- 1日のスケジュール表示機能

#### 3.2.3 複雑な給与計算システム

**基本構成**
- 基本給：50,000円（固定）
- 訪問報酬基準額：270,000円
- 給与計算式：基本給 + (訪問報酬基準額 × 各係数の積)

**変動要素（5つの係数）の詳細**

1. **(A) 訪問件数係数**
   - 基準：100件/月（5件/日×20日）= 係数1.0
   - 計算方法：実際の訪問件数 ÷ 100
   - 例：105件の場合 → 係数1.05

2. **(B) 訪問時間係数**
   - 基準：1時間 = 係数1.0
   - 計算方法：実際の平均訪問時間（分） ÷ 60
   - 例：64.2分の場合 → 係数1.07

3. **(C) 利用者満足度評価係数**
   - 評価範囲：0-10点（0.1点単位）
   - 基準値：5点 = 係数1.0
   - 計算方法：
     - 5点以上：1.0 + ((評価点 - 5) × 0.02)
     - 5点未満：1.0 - ((5 - 評価点) × 0.02)
   - 例：6.5点の場合 → 1.0 + (1.5 × 0.02) = 係数1.03

4. **(D) 訪問件数連続基準数到達係数**
   - 初期値：係数1.0
   - 増加率：連続到達月数毎に+0.01
   - 上限：係数1.10（10ヶ月連続で上限到達）
   - リセット条件：月間100件未満の場合、翌月から係数1.0に戻る
   - 例：4ヶ月連続達成 → 係数1.04

5. **(E) 利用者難易度係数**
   - 評価範囲：0-10点（0.1点単位）
   - 基準値：5点 = 係数1.0
   - 計算方法：
     - 5点以上：1.0 + ((評価点 - 5) × 0.02)
     - 5点未満：1.0 - ((5 - 評価点) × 0.02)
   - 例：6.5点の場合 → 1.0 + (1.5 × 0.02) = 係数1.03
   - 評価項目例：医療処置の複雑さ、認知症の程度、身体介護の必要度等

**月額報酬計算例**
- 訪問件数：105件（係数A = 1.05）
- 平均訪問時間：64.2分（係数B = 1.07）
- 利用者満足度：6.5点（係数C = 1.03）
- 連続達成：4ヶ月（係数D = 1.04）
- 利用者難易度：6.5点（係数E = 1.03）
- 計算：50,000円 + (270,000円 × 1.05×1.07×1.03×1.04×1.03) = 384,691円

**システム機能要件**
- 月次自動計算機能
- 各係数の自動算出機能
- CSVエクスポート機能（税理士連携用）

#### 3.2.4 看護記録の自動化
- 音声入力機能（ヘッドセット対応）
- 音声データのテキスト自動変換
- 既存システム（カイポケ等）へのコピー＆ペースト対応
- 記録テンプレート機能

#### 3.2.5 利用者評価システム
- LINEのようなシンプルなUI
- バー（ゲージ）を動かすだけの簡単操作
- 0-10点の評価（0.1点単位）
- 評価結果の自動集計

#### 3.2.6 訪問ルート最適化
- Googleマップ連携
- 効率的な訪問順序の自動提案
- スタッフと利用者の相性考慮

#### 3.2.7 求人文章作成支援
- AIによる求人文章の自動生成
- 目的に応じた文章カスタマイズ
- ホームページ・求人サイト用文章の作成

### 3.3 管理機能
- シフト承認・修正機能
- 給与データ確認・修正機能
- スタッフ勤怠状況の一覧表示
- 利用者情報管理
- レポート出力機能（Excel形式）

## 4. 非機能要件

### 4.1 パフォーマンス要件
- **レスポンス時間**: 3秒以内（通常操作）
- **同時接続数**: 10名以下
- **データ処理量**: 月間1,000件以下の訪問記録処理

### 4.2 セキュリティ要件
- **認証方式**: ID/パスワード認証（将来的に2要素認証）
- **データ暗号化**: 通信時SSL/TLS暗号化、保存時暗号化
- **アクセス制御**: ロールベースアクセス制御（RBAC）
- **個人情報保護**: 利用者情報の適切な管理

### 4.3 可用性要件
- **稼働率**: 99.5%以上
- **バックアップ**: 日次自動バックアップ
- **障害復旧時間**: 4時間以内

### 4.4 互換性要件
- **対応ブラウザ**: Chrome、Safari、Edge（最新版）
- **対応デバイス**: PC、スマートフォン、タブレット
- **対応OS**: Windows 10以降、macOS、iOS、Android

## 5. システム構成

### 5.1 アーキテクチャ
クラウドベースのWebアプリケーション（段階的な機能追加を前提とした拡張可能な設計）

### 5.2 技術スタック
- **フロントエンド**: 
  - Next.js 14（App Router）- フルスタックフレームワーク
  - React 18 - UIライブラリ
  - TypeScript - 型安全性の確保
  - Tailwind CSS - スタイリング
- **バックエンド**: 
  - Next.js API Routes - APIエンドポイント
  - Python（シフト最適化処理用）- 別途APIサーバー
- **データベース**: 
  - Supabase（PostgreSQL） - メインデータベース
  - リアルタイム機能（勤怠打刻等）
  - 認証機能（Supabase Auth）
- **インフラ**: 
  - Vercel - ホスティング、自動デプロイ
  - Edge Functions - 高速レスポンス
- **AI/ML**: 
  - OpenAI API - 文章生成、データ分析
  - Google Speech-to-Text API - 音声認識
  - Vercel AI SDK - AIインテグレーション

### 5.3 外部連携
- Google Maps API（ルート最適化）
- LINE Messaging API（評価システム）
- OpenAI API（文章生成、シフト最適化）
- Google Speech-to-Text API（音声認識）
- 既存介護ソフト（カイポケ等）※データ連携は制限あり

## 6. 画面要件

### 6.1 画面一覧
- ログイン画面
- ダッシュボード（スタッフ用/管理者用）
- シフト希望提出画面
- 勤怠打刻画面（GPS連動）
- 訪問スケジュール確認画面
- 看護記録入力画面
- 利用者評価画面
- 給与確認画面
- 管理者用シフト調整画面
- 各種設定画面

### 6.2 画面遷移図
ログイン → ダッシュボード → 各機能画面への遷移

## 7. データ要件

### 7.1 データモデル
- **スタッフ情報**: 氏名、ID、連絡先、資格、勤務可能時間
- **利用者情報**: 氏名、住所、訪問時間枠、難易度評価
- **訪問記録**: 日時、場所（GPS）、担当スタッフ、実施内容
- **シフト情報**: 希望シフト、確定シフト、変更履歴
- **給与情報**: 基本給、変動給、評価点数、支給額
- **評価情報**: 利用者からの評価、スタッフ間評価

### 7.2 データ保持期間
- 訪問記録：3年間
- 給与データ：7年間
- 評価データ：1年間
- その他業務データ：3年間

## 8. 制約事項

### 8.1 技術的制約
- 既存介護ソフト（カイポケ等）との完全な連携は困難
- リアルタイム音声対応（オンコール自動化）は現時点で実装不可

### 8.2 ビジネス制約
- 介護保険法に基づく訪問時間枠の遵守
- 個人情報保護法の遵守
- 労働基準法に基づく勤怠管理

### 8.3 法的制約
- 医療・介護情報の取り扱いに関する法規制
- 個人情報保護法
- 労働関連法規

## 9. スケジュール

### 9.1 マイルストーン
- **要件定義完了**: 即日
- **基本設計完了**: 1週間後
- **第1フェーズ開発完了**: 3週間後
- **テスト完了**: 4週間後
- **初期リリース**: 来月1日

### 9.2 フェーズ別スケジュール
- **第1フェーズ**（最優先）：勤怠管理、シフト作成
- **第2フェーズ**：給与計算、評価システム
- **第3フェーズ**：看護記録自動化、ルート最適化
- **第4フェーズ**：求人文章作成、その他機能

## 10. リスク管理

### 10.1 想定リスク
- 短納期による品質リスク
- スタッフのシステム習熟度不足
- 既存システムとの連携制限
- 個人情報漏洩リスク

### 10.2 リスク対策
- 段階的リリースによる品質確保
- 操作研修の実施
- 手動データ連携の運用フロー確立
- セキュリティ監査の実施

## 11. 成果物

### 11.1 納品物一覧
- [x] ソースコード一式
- [x] システム設計書
- [x] 操作マニュアル（スタッフ用/管理者用）
- [x] 運用・保守マニュアル
- [x] テスト結果報告書

## 12. 予算

### 12.1 開発費用
- 開発費用：180万円
    -契約済み
- 段階的な機能追加により費用を分散

### 12.2 運用費用
- 月額保守費用：別途協議
- クラウドインフラ費用：利用量に応じて変動

## 13. 承認

### 13.1 承認者
- **要件定義承認者**: 志水様 [日付]
- **プロジェクトオーナー承認**: 林様 [日付]

---

作成日: 2025年7月8日  
最終更新日: 2025年7月8日  
バージョン: 1.0