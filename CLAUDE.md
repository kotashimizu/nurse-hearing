# CLAUDE.md - 訪問看護事業支援システム開発ガイド

## プロジェクト概要
訪問看護事業における業務効率化と品質向上を実現するための統合管理システムの開発

## 重要な指示

### 🔴 必須確認事項
**あなたが何か作業を開始する前に、必ず以下を実行してください：**

1. **Taskmaster AIで現在のタスクを確認**
   ```bash
   # 最優先: Taskmaster AIで次のタスクを確認
   npm run task:next
   ```

2. **TODO.mdファイルを確認**
   ```bash
   # 進捗状況の全体像を把握
   npm run task:progress
   ```
   - 現在どのフェーズにいるか確認
   - 完了済みタスクと未完了タスクを把握
   - 作業の優先順位を理解

3. **関連ドキュメントの確認**
   - `requirements.md` - 要件定義
   - `client-questions.md` - クライアント確認事項
   - 該当フェーズの設計書

### 作業フロー

1. **タスク開始時**
   - TODO.mdで該当タスクを確認
   - 関連する要件を requirements.md で確認
   - 必要に応じて client-questions.md の確認事項をチェック

2. **実装時**
   - 要件定義に基づいて実装
   - セキュリティとプライバシー保護を最優先
   - テスト可能なコードを書く

3. **タスク完了時**
   - TODO.mdのチェックボックスを更新（[ ] → [x]）
   - 必要に応じてドキュメントを更新
   - gitでコミット

### 技術スタック
- **フロントエンド**: Next.js 14, React 18, TypeScript, Tailwind CSS
- **バックエンド**: Next.js API Routes, Python (シフト最適化)
- **データベース**: Supabase (PostgreSQL)
- **認証**: Supabase Auth
- **外部API**: Google Maps, Google Speech-to-Text, OpenAI, LINE Messaging

### コーディング規約

1. **TypeScript**
   - strictモードを使用
   - 型定義を明示的に記述
   - any型の使用禁止

2. **ファイル構成**
   ```
   src/
   ├── app/          # Next.js App Router
   ├── components/   # 再利用可能なコンポーネント
   ├── lib/          # ユーティリティ関数
   ├── types/        # 型定義
   └── config/       # 設定ファイル
   ```

3. **命名規則**
   - コンポーネント: PascalCase
   - 関数・変数: camelCase
   - 定数: UPPER_SNAKE_CASE
   - ファイル: kebab-case

### セキュリティ要件

1. **認証・認可**
   - Supabase RLS (Row Level Security) を必須使用
   - ロールベースアクセス制御 (管理者/スタッフ/事務)

2. **データ保護**
   - 個人情報は必ず暗号化
   - APIキーは環境変数で管理
   - SQLインジェクション対策

3. **通信**
   - HTTPS必須
   - CORS設定の適切な管理

### Git運用

1. **ブランチ戦略**
   - main: 本番環境
   - develop: 開発環境
   - feature/*: 機能開発
   - hotfix/*: 緊急修正

2. **コミットメッセージ**
   ```
   feat: 新機能追加
   fix: バグ修正
   docs: ドキュメント更新
   refactor: リファクタリング
   test: テスト追加・修正
   ```

### 開発時の注意事項

1. **モバイルファースト**
   - 訪問看護スタッフは主にスマートフォンやタブレットを使用
   - レスポンシブデザイン必須

2. **オフライン対応**
   - 訪問先でのネットワーク環境を考慮
   - 重要機能はオフラインでも動作可能に

3. **パフォーマンス**
   - ページロード3秒以内
   - リアルタイム性が必要な機能の最適化

### テスト要件

1. **単体テスト**
   - Jest + React Testing Library
   - カバレッジ80%以上

2. **E2Eテスト**
   - Playwright
   - 主要なユーザーフローをカバー

3. **手動テスト**
   - 実機でのテスト必須
   - GPS機能は実地テスト

### E2Eテストの実行タイミング

#### 🚀 自動E2Eテスト実行トリガー
以下のタスクが完了したら、自動的にE2Eテストを実行します：

1. **基本機能完成時**
   - [ ] ユーザー管理機能（ログイン、権限管理）の実装完了時
   - [ ] 各画面の基本実装完了時

2. **フェーズ完了時**
   - [ ] 第1フェーズ完了時：ログイン→シフト管理→勤怠打刻フロー
   - [ ] 第2フェーズ完了時：給与計算・評価システムフロー
   - [ ] 第3フェーズ完了時：看護記録・ルート最適化フロー

3. **統合時**
   - [ ] 外部API連携実装後（Google Maps, LINE等）
   - [ ] 本番環境デプロイ前

#### E2Eテストシナリオ

**フェーズ1のE2Eテスト**
```
1. ログインフロー
   - 各ロール（管理者/スタッフ/事務）でログイン
   - 権限に応じた画面表示確認

2. シフト管理フロー
   - スタッフ：シフト希望提出
   - 管理者：シフト確認・承認
   - 通知確認

3. 勤怠管理フロー  
   - GPS打刻
   - スケジュール確認
   - 打刻修正
```

**自動実行時の動作**
TODOの特定項目が完了すると：
1. Playwright MCPが自動起動
2. 該当フェーズのE2Eテストを実行
3. 結果をレポート

---

**重要**: 作業を開始する前に必ずTODO.mdを確認し、現在の進捗と次のタスクを把握してください。